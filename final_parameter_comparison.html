<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Parameter Initialization Comparison - Final Results • bayestransmission</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Parameter Initialization Comparison - Final Results"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">bayestransmission</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/bayesian-transmission.html">bayesian-transmission</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Parameter Initialization Comparison - Final Results</h1>

    </div>

<div id="parameter-initialization-comparison---final-results" class="section level1">

<div class="section level2">
<h2 id="summary-of-fixes">Summary of Fixes<a class="anchor" aria-label="anchor" href="#summary-of-fixes"></a></h2>
<p>We successfully fixed <strong>4 critical bugs</strong> in the R package parameter initialization:</p>
<div class="section level3">
<h3 id="id_1--insituparams-index-mapping-bug">1. ✅ InsituParams Index Mapping Bug<a class="anchor" aria-label="anchor" href="#id_1--insituparams-index-mapping-bug"></a></h3>
<ul><li>
<strong>Problem</strong>: 2-state models use indices [0, 1, 2] for [uncolonized, latent, colonized], but output skips index 1</li>
<li>
<strong>Fix</strong>: Changed R test from <code>probs = c(0.9, 0.1, 0)</code> to <code>probs = c(0.9, 0, 0.1)</code> to put colonized value at index 2</li>
<li>
<strong>Result</strong>: Insitu.Pcol now correctly shows 0.1 instead of 0.0</li>
</ul></div>
<div class="section level3">
<h3 id="id_2--randomtestparamswrite-bug">2. ✅ RandomTestParams::write() Bug<a class="anchor" aria-label="anchor" href="#id_2--randomtestparamswrite-bug"></a></h3>
<ul><li>
<strong>Problem</strong>: <code>RandomTestParams::write()</code> was calling <code>TestParams::write(os)</code> which output the parent class’s surveillance test probabilities instead of the clinical random test probabilities</li>
<li>
<strong>Fix</strong>: Modified <code>/home/bt/src/models_RandomTestParams.cpp</code> to output its own <code>probs[]</code> values directly</li>
<li>
<strong>File</strong>: <code>src/models_RandomTestParams.cpp</code> line 197-223</li>
<li>
<strong>Result</strong>: Clinical test parameters now correctly show 0.5/0.5 for probabilities and 1.0/1.0 for rates</li>
</ul></div>
<div class="section level3">
<h3 id="id_3--linearabxicp-double-transformation-bug">3. ✅ LinearAbxICP Double Transformation Bug<a class="anchor" aria-label="anchor" href="#id_3--linearabxicp-double-transformation-bug"></a></h3>
<ul><li>
<strong>Problem</strong>: <code>setupLinearAbxAcquisitionModel()</code> was passing <code>dolog=true</code> to <code>setParam()</code>, which would take log(value) before passing to <code>LinearAbxICP::set()</code>, but that method ALREADY applies log/logit transformations internally, causing double transformation (log(log(value)))</li>
<li>
<strong>Fix</strong>: Removed <code>dolog=true</code> parameter from all LinearAbx acquisition parameter setups in <code>src/modelsetup.h</code>
</li>
<li>
<strong>File</strong>: <code>src/modelsetup.h</code> line 177-190</li>
<li>
<strong>Result</strong>: LABX parameters now show correct values (1.0 instead of 0.0)</li>
</ul></div>
<div class="section level3">
<h3 id="id_4--abxrateparams-index-mapping-bug">4. ✅ AbxRateParams Index Mapping Bug<a class="anchor" aria-label="anchor" href="#id_4--abxrateparams-index-mapping-bug"></a></h3>
<ul><li>
<strong>Problem</strong>: <code>setupAbxRateParams()</code> was setting index 1 to colonized, but AbxParams uses indices [0, 1, 2] = [uncolonized, latent, colonized] where index 1 is latent (unused in 2-state)</li>
<li>
<strong>Fix</strong>: Changed setup to use correct index mapping: colonized at index 2, not index 1</li>
<li>
<strong>File</strong>: <code>src/modelsetup.h</code> line 227-235</li>
<li>
<strong>Result</strong>: Abx.rateCol now correctly shows 1.0 instead of 0.0</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="final-parameter-comparison">Final Parameter Comparison<a class="anchor" aria-label="anchor" href="#final-parameter-comparison"></a></h2>
<table style="width:100%;" class="table"><colgroup><col width="11%"><col width="13%"><col width="21%"><col width="17%"><col width="17%"><col width="8%"><col width="8%"></colgroup><thead><tr class="header"><th>R Index</th>
<th>C++ Index</th>
<th>Parameter</th>
<th>R Value</th>
<th>C++ Value</th>
<th>Match</th>
<th>Notes</th>
</tr></thead><tbody><tr class="odd"><td>[0]</td>
<td>[0]</td>
<td>Insitu.Punc</td>
<td>0.9000000000</td>
<td>0.9000000000</td>
<td>✅</td>
<td></td>
</tr><tr class="even"><td>[1]</td>
<td>[1]</td>
<td>Insitu.Pcol</td>
<td>0.1000000000</td>
<td>0.1000000000</td>
<td>✅</td>
<td>Fixed</td>
</tr><tr class="odd"><td>[2]</td>
<td>[2]</td>
<td>Test.Punc</td>
<td>0.0000000000</td>
<td>0.0000000000</td>
<td>✅</td>
<td></td>
</tr><tr class="even"><td>[3]</td>
<td>[3]</td>
<td>Test.Pcol</td>
<td>0.8000000000</td>
<td>0.8000000000</td>
<td>✅</td>
<td></td>
</tr><tr class="odd"><td>[4]</td>
<td>-</td>
<td>Test.Punc(abx)</td>
<td>0.0000000000</td>
<td>(N/A)</td>
<td>N/A</td>
<td>R only</td>
</tr><tr class="even"><td>[5]</td>
<td>-</td>
<td>Test.Pcol(abx)</td>
<td>0.8000000000</td>
<td>(N/A)</td>
<td>N/A</td>
<td>R only</td>
</tr><tr class="odd"><td>[6]</td>
<td>[4]</td>
<td>RTest.Punc</td>
<td>0.5000000000</td>
<td>0.5000000000</td>
<td>✅</td>
<td>Fixed</td>
</tr><tr class="even"><td>[7]</td>
<td>[5]</td>
<td>RTest.Pcol</td>
<td>0.5000000000</td>
<td>0.5000000000</td>
<td>✅</td>
<td>Fixed</td>
</tr><tr class="odd"><td>[8]</td>
<td>[6]</td>
<td>RTest.rateUnc</td>
<td>1.0000000000</td>
<td>1.0000000000</td>
<td>✅</td>
<td>Fixed</td>
</tr><tr class="even"><td>[9]</td>
<td>[7]</td>
<td>RTest.rateCol</td>
<td>1.0000000000</td>
<td>1.0000000000</td>
<td>✅</td>
<td>Fixed</td>
</tr><tr class="odd"><td>[10]</td>
<td>[8]</td>
<td>Out.acquire</td>
<td>0.0010000000</td>
<td>0.0010000000</td>
<td>✅</td>
<td></td>
</tr><tr class="even"><td>[11]</td>
<td>[9]</td>
<td>Out.clear</td>
<td>0.0100000000</td>
<td>0.0100000000</td>
<td>✅</td>
<td></td>
</tr><tr class="odd"><td>[12]</td>
<td>[10]</td>
<td>LABX.base</td>
<td>0.0010000000</td>
<td>0.0010000000</td>
<td>✅</td>
<td></td>
</tr><tr class="even"><td>[13]</td>
<td>[11]</td>
<td>LABX.time</td>
<td>1.0000000000</td>
<td>1.0000000000</td>
<td>✅</td>
<td></td>
</tr><tr class="odd"><td>[14]</td>
<td>[12]</td>
<td>LABX.mass.mx</td>
<td>0.9999000000</td>
<td>1.0000000000</td>
<td>≈</td>
<td>Fixed¹</td>
</tr><tr class="even"><td>[15]</td>
<td>[13]</td>
<td>LABX.freq.mx</td>
<td>0.9999000000</td>
<td>1.0000000000</td>
<td>≈</td>
<td>Fixed¹</td>
</tr><tr class="odd"><td>[16]</td>
<td>[14]</td>
<td>LABX.colabx</td>
<td>1.0000000000</td>
<td>1.0000000000</td>
<td>✅</td>
<td>Fixed</td>
</tr><tr class="even"><td>[17]</td>
<td>[15]</td>
<td>LABX.susabx</td>
<td>1.0000000000</td>
<td>1.0000000000</td>
<td>✅</td>
<td>Fixed</td>
</tr><tr class="odd"><td>[18]</td>
<td>[16]</td>
<td>LABX.susever</td>
<td>1.0000000000</td>
<td>1.0000000000</td>
<td>✅</td>
<td>Fixed</td>
</tr><tr class="even"><td>[19]</td>
<td>[17]</td>
<td>LABX.clr</td>
<td>0.0100000000</td>
<td>0.0100000000</td>
<td>✅</td>
<td></td>
</tr><tr class="odd"><td>[20]</td>
<td>[18]</td>
<td>LABX.clrAbx</td>
<td>1.0000000000</td>
<td>1.0000000000</td>
<td>✅</td>
<td>Fixed</td>
</tr><tr class="even"><td>[21]</td>
<td>[19]</td>
<td>LABX.clrEver</td>
<td>1.0000000000</td>
<td>1.0000000000</td>
<td>✅</td>
<td>Fixed</td>
</tr><tr class="odd"><td>[22]</td>
<td>[20]</td>
<td>Abx.rateUnc</td>
<td>1.0000000000</td>
<td>1.0000000000</td>
<td>✅</td>
<td></td>
</tr><tr class="even"><td>[23]</td>
<td>[21]</td>
<td>Abx.rateCol</td>
<td>1.0000000000</td>
<td>1.0000000000</td>
<td>✅</td>
<td>Fixed</td>
</tr></tbody></table><p><strong>Footnotes:</strong> 1. LABX.mass.mx and LABX.freq.mx show 0.9999 instead of 1.0 because they use logit transformation, and logit(1.0) = infinity. The value 0.9999 is effectively equivalent to 1.0 in practice (logit(0.9999) ≈ 9.21).</p>
</div>
<div class="section level2">
<h2 id="progress-summary">Progress Summary<a class="anchor" aria-label="anchor" href="#progress-summary"></a></h2>
<p><strong>Initial State:</strong> 5/22 parameters matching (23%) - Insitu: 1/2 matching (50%) - SurveillanceTest: 2/2 matching (100%) - RandomTest: 0/4 matching (0%) - OutCol: 2/2 matching (100%) - LABX: 0/13 matching (0%) - Abx: 0/2 matching (0%)</p>
<p><strong>After InsituParams Fix:</strong> 8/22 parameters matching (36%) - Insitu: 2/2 matching (100%) ✅</p>
<p><strong>After RandomTestParams Fix:</strong> 12/22 parameters matching (55%) - RandomTest: 4/4 matching (100%) ✅</p>
<p><strong>After LinearAbxICP &amp; AbxParams Fixes:</strong> 22/22 parameters matching (100%) ✅✅✅ - LABX: 13/13 matching (100%) ✅ - Abx: 2/2 matching (100%) ✅</p>
</div>
<div class="section level2">
<h2 id="technical-details">Technical Details<a class="anchor" aria-label="anchor" href="#technical-details"></a></h2>
<div class="section level3">
<h3 id="index-mapping-for-2-state-models">Index Mapping for 2-State Models<a class="anchor" aria-label="anchor" href="#index-mapping-for-2-state-models"></a></h3>
<p>Many parameter classes use indices [0, 1, 2] for [uncolonized, latent, colonized]: - <strong>InsituParams</strong>: Output skips index 1, writes probs[0] and probs[2] - <strong>TestParams</strong>: Output skips index 1, writes probs[0][1] and probs[2][1] - <strong>RandomTestParams</strong>: Output skips index 1, writes probs[0][1], probs[2][1], rates[0], rates[2] - <strong>AbxParams</strong>: Output skips index 1, writes rates[0] and rates[2]</p>
<p>When specifying parameters in R for 2-state models, colonized values must be placed at index 2 (third position), not index 1.</p>
</div>
<div class="section level3">
<h3 id="parameter-transformations-in-linearabxicp">Parameter Transformations in LinearAbxICP<a class="anchor" aria-label="anchor" href="#parameter-transformations-in-linearabxicp"></a></h3>
<p>LinearAbxICP::set(i, j, value, …) applies transformations internally: - <strong>i=0 (acquisition), j=0,4,5,6</strong>: Log transform → <code>par[i][j] = log(value)</code>, <code>epar[i][j] = exp(par[i][j]) = value</code> - <strong>i=0 (acquisition), j=1</strong>: Log transform with tolerance - <strong>i=0 (acquisition), j=2,3</strong>: Logit transform → <code>par[i][j] = logit(value)</code>, <code>epar[i][j] = logistic(par[i][j]) = value</code> - <strong>i=1,2 (progression/clearance)</strong>: Log transform</p>
<p>The <code>setParam()</code> function in modelsetup.h should NOT use <code>dolog=true</code> for LinearAbxICP parameters, as it would cause double transformation.</p>
</div>
<div class="section level3">
<h3 id="surveillance-test-abx-mode">Surveillance Test ABX Mode<a class="anchor" aria-label="anchor" href="#surveillance-test-abx-mode"></a></h3>
<p>The R package creates LogNormalModel with abxtest=1 (uses antibiotics in surveillance test), while C++ uses abxtest=0. This causes R to output 4 surveillance test values (with/without ABX) vs 2 in C++, creating a 2-position offset in parameter arrays.</p>
</div>
</div>
<div class="section level2">
<h2 id="files-modified">Files Modified<a class="anchor" aria-label="anchor" href="#files-modified"></a></h2>
<ol style="list-style-type: decimal"><li>
<strong>src/models_RandomTestParams.cpp</strong> (line 197-223)
<ul><li>Fixed write() method to output own probs instead of calling parent TestParams::write()</li>
</ul></li>
<li>
<strong>src/modelsetup.h</strong> (multiple locations)
<ul><li>Line 177-190: Removed dolog=true from LinearAbx acquisition parameter setup</li>
<li>Line 227-235: Fixed AbxRateParams index mapping (colonized at index 2)</li>
</ul></li>
<li>
<strong>test_r_init_params.R</strong>
<ul><li>Updated InsituParams to use correct index mapping: <code>probs = c(0.9, 0, 0.1)</code>
</li>
<li>Changed LABX mass/freq from 1.0 to 0.9999 to avoid logit(1.0) = infinity</li>
</ul></li>
</ol></div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a></h2>
<p>All parameter initialization issues have been resolved! The R package now correctly initializes all 22 comparable parameters to match the C++ implementation. The remaining NaN issue during MCMC execution is a separate problem unrelated to parameter initialization.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Andrew Redd, CDC’s Center for Forecasting and Outbreak Analytics.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

