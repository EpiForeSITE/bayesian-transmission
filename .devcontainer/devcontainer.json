{
  "name": "R Debug Environment",
  "image": "wch1/r-debug:latest",
  
  // Set environment variables
  "containerEnv": {
    "LANG": "en_US.UTF-8",
    "ASAN_OPTIONS": "detect_leaks=0:detect_odr_violation=0",
    "UBSAN_OPTIONS": "print_stacktrace=1",
    "RJAVA_JVM_STACK_WORKAROUND": "0",
    "RGL_USE_NULL": "true",
    "R_DONT_USE_TK": "true"
    },

  // Mount the workspace
  "workspaceFolder": "/home/bt",
  "workspaceMount": "source=${localWorkspaceFolder},target=/home/bt,type=bind",

  // Features to add
  "features": {
    "ghcr.io/devcontainers/features/git:1": {},
    "ghcr.io/devcontainers/features/github-cli:1": {}
  },

  // VS Code extensions to install
    "customizations": {
        "vscode": {
            "extensions": [
        "REditorSupport.r",
        "RDebugger.r-debugger",
        "ms-vscode.cpptools",
        "ms-vscode.cmake-tools",
                "quarto.quarto",
                "ms-vscode.makefile-tools"

      ],
      "settings": {
        "r.rterm.linux": "/usr/local/RD/bin/R",
        "r.rpath.linux": "/usr/local/RD/bin/R",
        "r.bracketedPaste": true,
        "r.sessionWatcher": true
      }
        }
    },

  // Keep the container running
  "overrideCommand": true,
  "shutdownAction": "stopContainer",

  // Post-create command to set up the environment
  "postCreateCommand": "bash -c 'sudo apt-get update && sudo apt-get install -y libfreetype6-dev libpng-dev libtiff5-dev libjpeg-dev libwebp-dev qpdf ccache && mkdir -p ~/.R && echo \"# System-level R build configuration for performance\" > ~/.R/Makevars && echo \"# These settings are environment-specific and not part of the repository\" >> ~/.R/Makevars && echo \"\" >> ~/.R/Makevars && echo \"# Enable parallel compilation (use all available cores)\" >> ~/.R/Makevars && echo \"MAKEFLAGS = -j14\" >> ~/.R/Makevars && echo \"\" >> ~/.R/Makevars && echo \"# Use ccache to speed up repeated compilations\" >> ~/.R/Makevars && echo \"CC = ccache gcc\" >> ~/.R/Makevars && echo \"CXX = ccache g++\" >> ~/.R/Makevars && echo \"CXX11 = ccache g++\" >> ~/.R/Makevars && echo \"CXX14 = ccache g++\" >> ~/.R/Makevars && echo \"CXX17 = ccache g++\" >> ~/.R/Makevars && Rscript -e \"install.packages(c(\\\"devtools\\\", \\\"RcppEigen\\\", \\\"checkmate\\\", \\\"testthat\\\", \\\"dplyr\\\", \\\"RcppArmadillo\\\", \\\"assertthat\\\"), repos=\\\"https://cloud.r-project.org\\\")\" && echo \"Dev container ready with devtools and ccache!\"'"
}
